services:
 immich-sever:
  image: ghcr.io/immich-app/immich-server:release
  container_name: immich-server-by-compose
  ports:
   - "1234:2283"
  volumes:
   - /mnt/data/photos/uploads:/usr/src/app/upload
  env_file: 
   - .env
  environment:
   DB_HOSTNAME: immich-postgres
   DB_USERNAME: postgres
   DB_PASSWORD: password
   DB_DATABASE_NAME: immich
   IMMICH_MACHINE_LEARNING: true
  restart: always
  depends_on:
   - immich-postgres

 immich-postgres:
  image: postgres:14
  container_name: immich-postgres-by-compose
  environment:
   POSTGRES_PASSWORD: password
  volumes:
   - immich_db:/var/lib/postgresql/data

 immich-machine-learning:
  container_name: immich-ML-by-compose
  # For hardware acceleration, add one of -[armnn, cuda, rocm, openvino, rknn] to the image tag.
  # Example tag: ${IMMICH_VERSION:-release}-cuda
  image: ghcr.io/immich-app/immich-machine-learning:release
  # extends: # uncomment this section for hardware acceleration - see https://immich.app/docs/features/ml-hardware-acceleration
  #   file: hwaccel.ml.yml
  #   service: cpu # set to one of [armnn, cuda, rocm, openvino, openvino-wsl, rknn] for accelerated inference - use the `-wsl` version for WSL2 where applicable
  volumes:
    - model-cache:/cache
  env_file:
    - .env
  restart: always
  healthcheck:
    disable: false
    
 filebrowser:
  image: filebrowser/filebrowser:s6
  container_name: filebrowser-by-compose
  user: "0:0"
  volumes:
   - /mnt/data/photos/uploads:/srv
   - /mnt/data/config/filebrowser.db:/database.db
   - /mnt/data/config/settings.json:/config/settings.json
  ports:
   - "2345:80"
  restart: unless-stopped

volumes:
 immich_db:
 model-cache:
